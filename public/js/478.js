"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[478],{478:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Ae});var i=t(821),a={class:"h-full w-5/6 relative p-1 shadow-inner bg-gray-100",ref:"room"},r={class:"absolute top-0 left-0 m-4"},o=(0,i._)("img",{src:"/images/tree.png",alt:""},null,-1),s=["onClick"],c=(0,i._)("img",{src:"/images/build.png",alt:""},null,-1),l=["onClick"],u=(0,i._)("span",{class:"color shadow-xl"},null,-1),h=[(0,i._)("img",{src:"/images/plus.png",style:{transform:"scale(0.5)"},alt:""},null,-1)];var f=t(757),m=t.n(f);const d={loaderFile:function(){window.onkeyup=function(e){107==e.keyCode&&(store.state.inspector?scene.debugLayer.show({embedMode:!0}):scene.debugLayer.hide(),store.state.inspector=!store.state.inspector)}}};function p(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.createScene(),this.setEnvironment()}return function(e,n,t){n&&p(e.prototype,n),t&&p(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"createScene",value:function(){var e=new BABYLON.Engine(canvas,!0);window.scene=new BABYLON.Scene(e),e.runRenderLoop((function(){scene.render()})),window.addEventListener("resize",(function(){e.resize()}))}},{key:"setEnvironment",value:function(){var e=BABYLON.CubeTexture.CreateFromPrefilteredData("./textures/hdrmini.env",scene);scene.environmentTexture=e,scene.clearColor=new BABYLON.Color3(.8,.8,.8,1)}}]),e}();function g(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var w=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.createLight()}return function(e,n,t){n&&g(e.prototype,n),t&&g(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"createLight",value:function(){this.light=new BABYLON.HemisphericLight("light",new BABYLON.Vector3(1,1,0))}}]),e}();function y(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var b=function(){function e(n){var t,i,a;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,i="keysArr",a=[{frame:0,value:new BABYLON.Color3(0,1,0)},{frame:20,value:new BABYLON.Color3(1,1,1)},{frame:20,value:new BABYLON.Color3(1,1,1)},{frame:40,value:new BABYLON.Color3(0,1,0)}],i in t?Object.defineProperty(t,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[i]=a,this.scene=n}return function(e,n,t){n&&y(e.prototype,n),t&&y(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"hover",value:function(e){var n=this,t=e.material;e.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPointerOverTrigger},(function(){n.scene.activeMesh!=e&&(e.material=n.scene.getMaterialByName("hover"))}))),e.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPointerOutTrigger},(function(){n.scene.activeMesh!=e&&(e.material=t)})))}},{key:"animate",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.keysArr;this.animation=new BABYLON.Animation("newBlink",e,60,n,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),this.animation.setKeys(t),this.animationGroup=new BABYLON.AnimationGroup("newBlinkGroup")}},{key:"animatePlay",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n&&this.animate("material.diffuseColor",BABYLON.Animation.ANIMATIONTYPE_COLOR3),e.material=this.scene.getMaterialByName("animated"),this.animationGroup.addTargetedAnimation(this.animation,e),this.animationGroup.play(!0)}},{key:"animateStop",value:function(){this.animationGroup.stop(),this.animationGroup.dispose()}}]),e}();function B(e,n,t,i,a,r,o){try{var s=e[r](o),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(i,a)}function k(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var M=function(){function e(){var n=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.actions=new b(scene),scene.onDataLoadedObservable.add((function(){n._createGround()}))}var n,t;return function(e,n,t){n&&k(e.prototype,n),t&&k(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"_createGround",value:function(){var e=BABYLON.MeshBuilder.CreateGround("ground",{width:1e3,height:1e3},scene);e.actionManager=new BABYLON.ActionManager(scene),e.material=scene.getMaterialByName("ground")}},{key:"createMesh",value:function(e){if(!scene.getNodeByName(e.name)){var n=[];JSON.parse(e.points).forEach((function(e){n.push(new BABYLON.Vector3(e.x,e.y,e.z))}));var t=BABYLON.MeshBuilder.ExtrudePolygon(e.name,{shape:n,depth:5,wrap:!0},scene);t.scaling=new BABYLON.Vector3(1,1,-1),t.material=scene.getMaterialByName("building"),t.mainmaterial=scene.getMaterialByName("building"),t.position.y=.01,t.position.x=1e3,t.position.z=1e3,t.rotation.x=Math.PI}}},{key:"getMeshes",value:(n=m().mark((function e(){var n=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,axios.get("/api/getactivemeshes");case 2:e.sent.data.forEach((function(e){var t=JSON.parse(e.position),i=scene.getNodeByName(e.parentname).clone(e.name);i.material=scene.getMaterialByName(e.materialname),i.mainmaterial=scene.getMaterialByName(e.materialname),i.setAbsolutePosition(t._x,t._y,t._z),"plant"==e.parentname?i.scaling.y=1:i.scaling.y=e.height,i.actionManager=new BABYLON.ActionManager(scene),n.actions.hover(i)}));case 4:case"end":return e.stop()}}),e)})),t=function(){var e=this,t=arguments;return new Promise((function(i,a){var r=n.apply(e,t);function o(e){B(r,i,a,o,s,"next",e)}function s(e){B(r,i,a,o,s,"throw",e)}o(void 0)}))},function(){return t.apply(this,arguments)})}]),e}();function O(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var C=function(){function e(){var n=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.Import(),scene.onDataLoadedObservable.add((function(){n.hideMeshes(["plant","house"])}))}return function(e,n,t){n&&O(e.prototype,n),t&&O(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"Import",value:function(){BABYLON.SceneLoader.AppendAsync("./models/assets.glb",void 0,scene,(function(e){e.lengthComputable&&(e.loaded,e.total)}),".glb")}},{key:"hideMeshes",value:function(e){e.forEach((function(e){var n=scene.getNodeByName(e);n.setAbsolutePosition(1e3,n.position.y,1e3)}))}}]),e}(),L=t(669),A=t.n(L);function P(e,n,t,i,a,r,o){try{var s=e[r](o),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(i,a)}function N(e){return function(){var n=this,t=arguments;return new Promise((function(i,a){var r=e.apply(n,t);function o(e){P(r,i,a,o,s,"next",e)}function s(e){P(r,i,a,o,s,"throw",e)}o(void 0)}))}}function x(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Y(e,n){var t=Math.round(e/n)*n;return 0==t&&(t=1e-4),t}var _=function(){function e(){var n=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.native=new M,this.actions=new b(scene),new C,scene.onPreKeyboardObservable.add((function(e){2==e.type&&"KeyX"==e.event.code&&store.state.mesh.active&&n.meshDelete(store.state.mesh.active)})),this.pickForDrag()}var n,t,i,a,r;return function(e,n,t){n&&x(e.prototype,n),t&&x(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"pickForDrag",value:function(){var e=this;scene.onPointerPick=function(n,t){var i=t.pickedMesh;0!=n.button&&2!=n.button||e.clearActiveMesh(),i&&"ground"!=i.name&&(n.shiftKey&&0==n.button?(store.state.mesh.active=i,e.position=i.absolutePosition.clone(),e.drag(i),e.drop(i)):0==n.button&&(e.getMesh(i),store.state.mesh.active=i,scene.activeMesh=i,e.actions.animatePlay(i,!0)))}}},{key:"clearActiveMesh",value:function(){store.state.mesh.active&&(this.actions.animateStop(),scene.activeMesh.material=scene.activeMesh.mainmaterial,scene.activeMesh=null,store.state.mesh.active=null,store.state.mesh.info=null)}},{key:"newMesh",value:function(e,n,t){this.clearActiveMesh(),scene.onPointerPick=null;var i=scene.getNodeByName(n).clone(e+Date.now());i.visibility=.5;var a=scene.getMaterialByName(e);a&&(i.material=a,i.mainmaterial=a),store.state.mesh.active=i,this.drag(i,!0,t),this.drop(i,n)}},{key:"drag",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2?arguments[2]:void 0;store.state.drag=!0,scene.onPointerMove=function(n,t){if(t.pickedPoint){var i=Y(t.pickedPoint.x,.5),a=Y(t.pickedPoint.z,.5);e.setAbsolutePosition(i,e.position.y,a)}},n&&scene.simulatePointerMove(scene.pick(t.clientX,t.clientY))}},{key:"drop",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;scene.onPointerPick=function(i){null!=store.state.mesh.active&&(0==i.button&&(t?(e.visibility=1,e.actionManager=new BABYLON.ActionManager(scene),n.actions.hover(e),n.saveMeshProps(e,t)):n.editMeshProps(e)),2==i.button&&(t?e.dispose():e.setAbsolutePosition(n.position)),scene.onPointerMove=null,store.state.mesh.active=null,store.state.drag=null,n.pickForDrag())}}},{key:"saveMeshProps",value:(r=N(m().mark((function e(n,t){var i,a,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.name,a=n.material.name,r=n.absolutePosition,e.next=5,A().post("/api/savemeshes",{name:i,position:r,material:a,parent:t});case 5:case"end":return e.stop()}}),e)}))),function(e,n){return r.apply(this,arguments)})},{key:"getMesh",value:(a=N(m().mark((function e(n){var t,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.name,e.next=3,A().post("/api/getmesh",{name:t});case 3:i=e.sent,a=i.data,store.state.mesh.info=a;case 6:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"editMesh",value:(i=N(m().mark((function e(n){var t,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.name,i=n.height,a=n.username,e.next=3,A().post("/api/editmesh",{name:t,height:i,username:a});case 3:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"editMeshProps",value:(t=N(m().mark((function e(n){var t,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.name,i=n.absolutePosition,e.next=4,A().post("/api/editmeshes",{name:t,position:i});case 4:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"meshDelete",value:(n=N(m().mark((function e(n){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.name,this.clearActiveMesh(),n.dispose(),e.next=5,A().post("/api/deletemesh",{name:t});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),e}();function j(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var E=function(){function e(){var n,t,i;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),n=this,t="camera",i=new BABYLON.ArcRotateCamera("camera",-Math.PI/2,0,40,new BABYLON.Vector3(0,0,0)),t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,this.createCamera(),this.limits()}return function(e,n,t){n&&j(e.prototype,n),t&&j(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"createCamera",value:function(){var e=this;this.camera.attachControl(canvas,!0),this.camera.mode=1,this.camera.minZ=0,this.camera.onViewMatrixChangedObservable.add((function(){e.orthographic()})),window.addEventListener("resize",(function(){e.orthographic()}))}},{key:"orthographic",value:function(){var e=canvas.width/canvas.height;this.camera.orthoTop=this.camera.radius/e,this.camera.orthoBottom=-this.camera.radius/e,this.camera.orthoLeft=-this.camera.radius,this.camera.orthoRight=this.camera.radius}},{key:"limits",value:function(){this.camera.useBouncingBehavior=!0,this.camera.lowerRadiusLimit=25,this.camera.upperRadiusLimit=120,this.camera.inputs.attached.keyboard.detachControl(),this.camera.inputs.attached.pointers.buttons=[1,2]}}]),e}();function D(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var T=function(){function e(n){var t=n.lines,i=void 0!==t&&t,a=n.grid,r=void 0!==a&&a;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),i&&this.Lines(),r&&this.Grid()}return function(e,n,t){n&&D(e.prototype,n),t&&D(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"Lines",value:function(){var e=[new BABYLON.Vector3(-300,0,0),new BABYLON.Vector3(300,0,0)],n=[new BABYLON.Color4(.5,0,0,.3),new BABYLON.Color4(.5,0,0,.3)],t=BABYLON.MeshBuilder.CreateLines("lineX",{points:e,colors:n});t.isPickable=!1,t.position.y=.002;var i=[new BABYLON.Vector3(0,0,-300),new BABYLON.Vector3(0,0,300)],a=[new BABYLON.Color4(0,0,.5,.3),new BABYLON.Color4(0,0,.5,.3)],r=BABYLON.MeshBuilder.CreateLines("lineZ",{points:i,colors:a});r.isPickable=!1,r.position.y=.002}},{key:"Grid",value:function(){var e=new BABYLON.GridMaterial("groundMaterial");e.majorUnitFrequency=1,e.minorUnitVisibility=.1,e.gridRatio=1,e.backFaceCulling=!1,e.mainColor=new BABYLON.Color3(1,1,1),e.lineColor=new BABYLON.Color3(1,1,1),e.opacity=.3;var n=BABYLON.Mesh.CreateGround("GridMain",2e4,2e4,2);n.position.y=.001,n.material=e,n.isPickable=!1}}]),e}();const S=[{name:"olma",color:"#2feb71"},{name:"behi",color:"#fdeb1c"},{name:"shaftoli",color:"#ba2222"}];function I(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function F(e,n,t){return n&&I(e.prototype,n),t&&I(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var z=F((function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var t=new BABYLON.StandardMaterial("building",n);t.diffuseColor=new BABYLON.Color3.FromHexString("#EFDC9A"),t.specularColor=new BABYLON.Color3(0,0,0);var i=new BABYLON.StandardMaterial("ground",n);i.diffuseColor=new BABYLON.Color3(1,1,1),i.specularColor=new BABYLON.Color3(0,0,0);var a=new BABYLON.StandardMaterial("hover",n);a.diffuseColor=BABYLON.Color3.FromHexString("#C8F5FF").toLinearSpace(),a.specularColor=new BABYLON.Color3(0,0,0),S.forEach((function(e){new BABYLON.StandardMaterial(e.name,n).diffuseColor=BABYLON.Color3.FromHexString(e.color).toLinearSpace()}));var r=new BABYLON.StandardMaterial("BluePoints",this.scene);r.diffuseColor=BABYLON.Color3.FromHexString("#3268D1"),r.specularColor=new BABYLON.Color3(0,0,0),new BABYLON.StandardMaterial("animated",this.scene).specularColor=new BABYLON.Color3(0,0,0)}));var G={class:"h-full w-full absolute top-0 left-0 p-8 bg-black bg-opacity-60"},R={class:"h-full w-full border-transparent",ref:"BuilderCanvas"},$=[(0,i._)("img",{src:"/images/close.png",class:"imgwhite w-4"},null,-1)],V={class:"absolute bottom-0 right-0 m-3"},K=(0,i._)("button",{type:"submit",class:"bg-green-600 p-2 px-4 text-white shadow-xl hover:bg-gray-700"}," Saqlash ",-1);function q(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var U=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.MeshBuilderScene(n)}return function(e,n,t){n&&q(e.prototype,n),t&&q(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"MeshBuilderScene",value:function(e){var n=this;BABYLON.Scene.DoubleClickDelay=600,this.engine=new BABYLON.Engine(e,!0),this.scene=new BABYLON.Scene(this.engine),this.engine.runRenderLoop((function(){n.scene.render()})),window.addEventListener("resize",(function(){n.engine.resize()}))}}]),e}();function H(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Z=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.createLight()}return function(e,n,t){n&&H(e.prototype,n),t&&H(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"createLight",value:function(){this.light=new BABYLON.HemisphericLight("light",new BABYLON.Vector3(1,1,0))}}]),e}();function X(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function J(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var W=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),J(this,"points",[]),J(this,"finishedPoints",[]),this.scene=n,this.actions=new b(n),this.createGround(),this.onKeyboard(),this.onDoubleClick(),this.onClick()}return function(e,n,t){n&&X(e.prototype,n),t&&X(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"onClick",value:function(){var e=this;this.scene.onPointerDown=function(n,t){if("linepoint"==t.pickedMesh.type){var i=t.pickedMesh;return e.scene.activeMesh&&i!=e.scene.activeMesh&&e.clearActiveMesh(),e.scene.activeMesh=i,void e.actions.animatePlay(i,!0)}2==n.button&&e.scene.activeMesh&&e.clearActiveMesh()}}},{key:"onDoubleClick",value:function(){var e=this;this.scene.onPointerObservable.add((function(n){if(n.type==BABYLON.PointerEventTypes.POINTERDOUBLETAP){var t=e.gridCoords(n.pickInfo);if(e.scene.activeMesh){var i=e.points.findIndex((function(n){return n.mesh===e.scene.activeMesh}));return e.points[i].mesh.position=t,e.points[i].coordinate=t,e.meshBuilder(e.points),void e.clearActiveMesh()}if("ground"!=n.pickInfo.pickedMesh.name||0!=event.button)return;e.createCube(t),e.meshBuilder(e.points)}}))}},{key:"clearActiveMesh",value:function(){this.actions.animateStop(),this.scene.activeMesh.material=this.scene.getMaterialByName("BluePoints"),this.scene.activeMesh=null}},{key:"onKeyboard",value:function(){var e=this;this.scene.onPreKeyboardObservable.add((function(n){if(2==n.type&&"KeyX"==n.event.code&&e.scene.activeMesh){var t=e.points.findIndex((function(n){return n.mesh===e.scene.activeMesh}));e.points[t].mesh.dispose(),e.points.splice(t,1),e.meshBuilder(e.points),e.scene.activeMesh=null}}))}},{key:"createCube",value:function(e){var n=BABYLON.MeshBuilder.CreateBox("cubicpoints",{height:.4,width:.4,size:.4},this.scene);this.points.push({mesh:n,coordinate:e}),n.type="linepoint",n.material=this.scene.getMaterialByName("BluePoints"),n.position=e,n.position.y=1,n.actionManager=new BABYLON.ActionManager(this.scene),this.actions.hover(n)}},{key:"meshBuilder",value:function(e){var n=this;if(this.finishedPoints=[],e.forEach((function(e){n.finishedPoints.push(e.coordinate)})),!(this.finishedPoints.length<2)){var t=this.scene.getNodeByName("line");t&&t.dispose(),BABYLON.MeshBuilder.CreateLines("line",{points:this.finishedPoints},this.scene).isPickable=!1}}},{key:"createGround",value:function(){var e=BABYLON.MeshBuilder.CreateGround("ground",{width:1e3,height:1e3},this.scene);e.actionManager=new BABYLON.ActionManager(this.scene);var n=new BABYLON.StandardMaterial("material",this.scene);n.diffuseColor=new BABYLON.Color3(.8,.8,.8),n.specularColor=new BABYLON.Color3(0,0,0),e.material=n}},{key:"numRound",value:function(e,n){return Math.round(e/n)*n}},{key:"gridCoords",value:function(e){var n=this.numRound(e.pickedPoint.x,1),t=this.numRound(e.pickedPoint.z,1);return new BABYLON.Vector3(n,1,t)}},{key:"getPoints",value:function(){var e=[];return this.finishedPoints.forEach((function(n){e.push({x:n.x,y:n.y,z:n.z})})),e}}]),e}();function Q(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ee=function(){function e(n){var t,i,a;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,i="camera",a=new BABYLON.ArcRotateCamera("camera",-Math.PI/2,0,40,new BABYLON.Vector3(0,0,0)),i in t?Object.defineProperty(t,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[i]=a,this.createCamera(n),this.limits()}return function(e,n,t){n&&Q(e.prototype,n),t&&Q(e,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"createCamera",value:function(e){var n=this;this.camera.attachControl(e,!0),this.camera.mode=1,this.camera.onViewMatrixChangedObservable.add((function(){n.orthographic(e)})),window.addEventListener("resize",(function(){n.orthographic(e)}))}},{key:"orthographic",value:function(e){var n=e.width/e.height;this.camera.orthoTop=this.camera.radius/n,this.camera.orthoBottom=-this.camera.radius/n,this.camera.orthoLeft=-this.camera.radius,this.camera.orthoRight=this.camera.radius}},{key:"limits",value:function(){this.camera.useBouncingBehavior=!0,this.camera.lowerRadiusLimit=5,this.camera.upperRadiusLimit=50,this.camera.lowerAlphaLimit=-Math.PI/2,this.camera.upperAlphaLimit=-Math.PI/2,this.camera.lowerBetaLimit=0,this.camera.upperBetaLimit=0,this.camera.inputs.attached.keyboard.detachControl(),this.camera.inputs.attached.pointers.buttons=[1,2]}}]),e}();function ne(e,n,t,i,a,r,o){try{var s=e[r](o),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(i,a)}const te={data:function(){return{clientname:""}},mounted:function(){this.MeshBuilder=function(e){var n=new U(e),t=new ee(e),i=new W(n.scene),a=new Z;return new T({lines:!1,grid:!0}),new z(n.scene),{Scene:n,Camera:t,Light:a,Meshes:i}}(this.$refs.BuilderCanvas)},methods:{insertPoints:function(){var e,n=this;return(e=m().mark((function e(){var t,i,a,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.MeshBuilder.Meshes.getPoints(),e.next=3,axios.get("/api/getmeshes");case 3:if(i=e.sent,a=i.data,r="createdMesh"+a.length,!(t.length>2)){e.next=11;break}return e.next=9,axios.post("/api/savepoints",{points:t,name:r,clientname:n.clientname});case 9:n.$emit("newmesh"),n.$emit("close");case 11:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(i,a){var r=e.apply(n,t);function o(e){ne(r,i,a,o,s,"next",e)}function s(e){ne(r,i,a,o,s,"throw",e)}o(void 0)}))})()}}};var ie=t(744);const ae=(0,ie.Z)(te,[["render",function(e,n,t,a,r,o){return(0,i.wg)(),(0,i.iD)("section",G,[(0,i._)("form",{class:"relative h-full shadow border-2 border-gray-500",onKeypress:n[2]||(n[2]=(0,i.D2)((0,i.iM)((function(){}),["prevent"]),["enter"])),onSubmit:n[3]||(n[3]=(0,i.iM)((function(){return o.insertPoints&&o.insertPoints.apply(o,arguments)}),["prevent"]))},[(0,i._)("canvas",R,null,512),(0,i._)("button",{onClick:n[0]||(n[0]=function(n){return e.$emit("close")}),class:"absolute flex items-center justify-center top-0 right-0 bg-red-500 p-2 px-4 m-3 shadow-xl hover:bg-red-700"},$),(0,i._)("div",V,[(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=function(e){return r.clientname=e}),class:"p-2 outline-none",placeholder:"Nomi",required:""},null,512),[[i.nr,r.clientname]]),K])],32)])}]]);var re={class:"w-1/6 flex flex-col h-full p-1 bg-gray-200"},oe={class:"h-full px-3 pt-3"},se={key:0},ce=(0,i._)("h3",{class:"text-center font-bold uppercase text-white py-2 bg-green-600 mb-4 rounded"},"Tanlangan obyekt",-1),le=(0,i._)("label",{for:"names",class:"text-sm text-gray-400"},"Obyektga nom berish",-1),ue={key:0},he=(0,i._)("label",{for:"height",class:"text-sm text-gray-400"},"Bino Balandligi",-1),fe={key:1},me=(0,i._)("aside",null,null,-1),de={class:"flex-grow"};var pe={class:"my-3"},ve={for:"fileinp",class:"mb-2 block shadow-lg text-center"},ge={class:"rounded w-full h-40 object-cover inline-block",ref:"imagePreview",src:"images/default.jpg"},we={key:0,class:"-ml-2 flex my-2"},ye=["src","onClick"],be=["onClick"],Be=[(0,i._)("img",{src:"/images/trash-bin.png",class:"w-4"},null,-1)],ke=(0,i._)("main",{class:"flex justify-end"},[(0,i._)("label",{for:"fileinp",class:"imageadd border-white border"},[(0,i._)("span",{class:"material-icons text-white"},[(0,i._)("img",{src:"/images/plus2.png",class:"cursor-pointer imgwhite w-6"})])])],-1);const Me={data:function(){return{images:[],files:[],bool:!0}},methods:{onchange:function(){this.addfiles(this.$refs.fileInput.files),this.sendFilesToServer(this.files),this.mainImage(this.images[this.images.length-1]),this.$refs.fileInput.value=null},addfiles:function(e){for(var n={images:[],files:[]},t=0;t<e.length;t++)n.images.push(URL.createObjectURL(e[t])),n.files.push(e[t]);for(var i in n.images)this.images.push(n.images[i]),this.files.push(n.files[i])},sendFilesToServer:function(e){var n=new FormData;for(var t in e)n.append("image[".concat(t,"]"),e[t]);axios.post("/api/upload",n).then((function(e){console.log(e)}))},deleteImage:function(e){if(this.images[e]==this.$refs.imagePreview.src)return this.images.splice(e,1),this.files.splice(e,1),void this.mainImage(this.images[this.images.length-1]);this.images.splice(e,1),this.files.splice(e,1)},mainImage:function(e){var n=this;this.bool=!1,setTimeout((function(){n.$refs.imagePreview.src=null==e?"images/default.jpg":e,n.bool=!0}),200)}}},Oe={data:function(){return{interval:null}},mounted:function(){this.engine=Engine.Meshes},methods:{edit:function(){var e=this;store.state.mesh.active.scaling.y=store.state.mesh.info.height,this.interval&&clearTimeout(this.interval),this.interval=setTimeout((function(){store.state.mesh.active&&e.engine.editMesh({name:store.state.mesh.active.name,height:store.state.mesh.info.height,username:store.state.mesh.info.username})}),800)},change:function(){this.engine.editMesh({name:store.state.mesh.active.name,height:store.state.mesh.info.height,username:store.state.mesh.info.username})}},components:{Uploader:(0,ie.Z)(Me,[["render",function(e,n,t,a,r,o){return(0,i.wg)(),(0,i.iD)("section",pe,[(0,i._)("label",ve,[(0,i.Wm)(i.uT,{name:"fade",mode:"out-in"},{default:(0,i.w5)((function(){return[(0,i.wy)((0,i._)("img",ge,null,512),[[i.F8,r.bool]])]})),_:1})]),(0,i._)("input",{id:"fileinp",type:"file",multiple:"",ref:"fileInput",accept:"image/png, image/gif, image/jpeg",onInput:n[0]||(n[0]=function(){return o.onchange&&o.onchange.apply(o,arguments)}),hidden:""},null,544),r.images.length?((0,i.wg)(),(0,i.iD)("div",we,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.images,(function(e,n){return(0,i.wg)(),(0,i.iD)("main",{class:"relative inline-block w-1/3",key:n},[(0,i._)("img",{src:e,onClick:function(n){return o.mainImage(e)},class:"object-cover pl-2 w-full h-20"},null,8,ye),(0,i._)("button",{class:"text-red-600 absolute top-0 right-0",onClick:function(e){return o.deleteImage(n)}},Be,8,be)])})),128))])):(0,i.kq)("",!0),ke])}]])}};function Ce(e,n,t,i,a,r,o){try{var s=e[r](o),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(i,a)}const Le={data:function(){return{fructs:S,fructMenu:!1,customMenu:!1,builderToggle:!1,customMeshes:[],engine:null,onload:null}},mounted:function(){var e,n,t,i,a=this;window.canvas=this.$refs.canvas,window.Engine=(e=new v,n=new E,t=new _(n),i=new w,new z(scene),new T({lines:!0,grid:!0}),{Scene:e,Camera:n,Light:i,Meshes:t}),d.loaderFile(),scene.onDataLoadedObservable.add((function(){a.onload=!0,Engine.Meshes.native.getMeshes()})),this.reloadMeshes()},methods:{addFruct:function(e,n){this.fructMenu=!1,Engine.Meshes.newMesh(e,n,event)},addBuilding:function(e,n){this.customMenu=!1,Engine.Meshes.newMesh(e,n,event)},openMeshBuilder:function(){this.builderToggle=!this.builderToggle},reloadMeshes:function(){var e,n=this;return(e=m().mark((function e(){var t,i,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.customMeshes=[],e.next=3,axios.get("/api/getmeshes");case 3:t=e.sent,i=t.data,a=Engine.Meshes.native,i.forEach((function(e){a.createMesh(e),n.customMeshes.push({clientname:e.clientname,name:e.name})}));case 7:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(i,a){var r=e.apply(n,t);function o(e){Ce(r,i,a,o,s,"next",e)}function s(e){Ce(r,i,a,o,s,"throw",e)}o(void 0)}))})()}},components:{MeshBuilder:ae,ConstructorPanel:(0,ie.Z)(Oe,[["render",function(e,n,t,a,r,o){var s=(0,i.up)("Uploader");return(0,i.wg)(),(0,i.iD)("main",re,[(0,i._)("aside",oe,[e.$store.state.mesh.info?((0,i.wg)(),(0,i.iD)("div",se,[ce,(0,i._)("main",null,[le,(0,i.wy)((0,i._)("input",{placeholder:"Nomlang",id:"names",class:"rounded border-b border-green-600 my-1 outline-none p-2 w-full",type:"text","onUpdate:modelValue":n[0]||(n[0]=function(n){return e.$store.state.mesh.info.username=n}),onChange:n[1]||(n[1]=function(){return o.change&&o.change.apply(o,arguments)}),onKeyup:n[2]||(n[2]=function(){return o.edit&&o.edit.apply(o,arguments)})},null,544),[[i.nr,e.$store.state.mesh.info.username]])]),"plant"!=e.$store.state.mesh.info.parentname?((0,i.wg)(),(0,i.iD)("main",ue,[he,(0,i.wy)((0,i._)("input",{placeholder:"Bino Balandligi",id:"height",class:"rounded border-b border-green-600 my-1 outline-none p-2 w-full",type:"text","onUpdate:modelValue":n[3]||(n[3]=function(n){return e.$store.state.mesh.info.height=n}),onChange:n[4]||(n[4]=function(e){return o.change(!0)}),onKeyup:n[5]||(n[5]=function(){return o.edit&&o.edit.apply(o,arguments)})},null,544),[[i.nr,e.$store.state.mesh.info.height]])])):(0,i.kq)("",!0),"plant"==e.$store.state.mesh.info.parentname?((0,i.wg)(),(0,i.iD)("main",fe,[me,(0,i.Wm)(s)])):(0,i.kq)("",!0)])):(0,i.kq)("",!0)]),(0,i._)("aside",de,[(0,i._)("button",{class:"rounded uppercase shadow-xl w-full p-3 py-2 text-green-600 border-2 border-green-600 hover:bg-green-600 hover:text-white",onClick:n[6]||(n[6]=function(n){return e.$store.dispatch("logout")})},"Chiqish")])])}]])}},Ae=(0,ie.Z)(Le,[["render",function(e,n,t,f,m,d){var p=(0,i.up)("MeshBuilder"),v=(0,i.up)("ConstructorPanel");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("main",a,[(0,i._)("section",r,[(0,i._)("div",{onClick:n[1]||(n[1]=function(e){m.fructMenu=!m.fructMenu,m.customMenu=!1}),class:(0,i.C_)([{"bg-gray-200":m.fructMenu},"m-2 mb-5 w-14 bg-white p-4 rounded-full shadow-xl relative cursor-pointer hover:bg-gray-200"])},[o,m.fructMenu?((0,i.wg)(),(0,i.iD)("main",{key:0,onClick:n[0]||(n[0]=(0,i.iM)((function(){}),["stop"])),class:"menu absolute bg-gray-100 shadow-xl px-4 py-2 top-0 text-gray-500"},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(m.fructs,(function(e){return(0,i.wg)(),(0,i.iD)("div",{key:e,onClick:function(n){return d.addFruct(e.name,"plant")},class:"flex items-center capitalize justify-between cursor-pointer hover:bg-green-500 hover:text-red-50 py-1 px-2 mb-2"},[(0,i.Uk)((0,i.zw)(e.name)+" ",1),(0,i._)("span",{style:(0,i.j5)({background:e.color}),class:"color shadow-xl"},null,4)],8,s)})),128))])):(0,i.kq)("",!0)],2),m.customMeshes.length>0?((0,i.wg)(),(0,i.iD)("div",{key:0,onClick:n[3]||(n[3]=function(e){m.customMenu=!m.customMenu,m.fructMenu=!1}),class:(0,i.C_)([{"bg-gray-200":m.customMenu},"m-2 mb-5 w-14 bg-white p-4 rounded-full shadow-xl relative cursor-pointer hover:bg-gray-200"])},[c,m.customMenu?((0,i.wg)(),(0,i.iD)("main",{key:0,onClick:n[2]||(n[2]=(0,i.iM)((function(){}),["stop"])),class:"menu absolute bg-gray-100 shadow-xl px-4 py-2 top-0 text-gray-500"},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(m.customMeshes,(function(e,n){return(0,i.wg)(),(0,i.iD)("div",{key:n,onClick:function(n){return d.addBuilding("building",e.name)},class:"flex items-center capitalize justify-between cursor-pointer hover:bg-green-500 hover:text-red-50 py-1 px-2 pb-2"},[(0,i.Uk)((0,i.zw)(e.clientname)+" ",1),u],8,l)})),128))])):(0,i.kq)("",!0)],2)):(0,i.kq)("",!0),(0,i._)("div",{onClick:n[4]||(n[4]=function(){return d.openMeshBuilder&&d.openMeshBuilder.apply(d,arguments)}),class:"m-2 mb-5 w-14 bg-white p-4 rounded-full shadow-xl cursor-pointer hover:bg-gray-200"},h)]),(0,i._)("canvas",{ref:"canvas",class:(0,i.C_)(["w-full h-full",{"cursor-move":e.$store.state.drag}])},null,2),m.builderToggle?((0,i.wg)(),(0,i.j4)(p,{key:0,onNewmesh:d.reloadMeshes,onClose:n[5]||(n[5]=function(e){return m.builderToggle=!1})},null,8,["onNewmesh"])):(0,i.kq)("",!0)],512),m.onload?((0,i.wg)(),(0,i.j4)(v,{key:0})):(0,i.kq)("",!0)],64)}]])}}]);